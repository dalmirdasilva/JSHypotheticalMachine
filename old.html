<div class="header">JS Hypothetical Machine (Neander Machine with Extended Instruction Set)</div>
<table border='1'>
    <tr>
        <td class="title">
            <div>Editor:</div>
        </td>
    </tr>
    <tr>
        <td valign="top">
            <table>
                <tr>
                    <td valign="top">
                        <div class="sub-title">Assembly editor</div>
                        <div>
                            <textarea id="assembly-code-box">
# Putting data into the memory
.db 55 100
.db 54 -1

# Begining of the program

# Load the value from the address 55
lda 55

# Add the value from the address 54
:add_point
call :sum_subroutine

# Jump if zero
jz :sleep_point

# Jump
jmp :add_point

# Sleep
:sleep_point
hlt

# Sum subroutine
:sum_subroutine
add 54
sta 101
ret

</textarea>
                        </div>
                        <div id="assembly-code-box-message"></div>
                        <button id="assemble-button">Assemble</button>
                        <span>(<a href="help.txt" channel="_blank">ajuda</a>)</span>
                    </td>
                    <td valign="top">
                        <div class="sub-title">Assembled code</div>
                        <div>
                            <textarea id="assembled-code-box"></textarea>
                        </div>
                        <div id="assembled-code-box-message"></div>
                        <button id="load-assembled-button">Load into memory</button>
                    </td>
                </tr>
            </table>
        </td>
        <td valign="top">
            <table>
                <tr>
                    <td valign="top">
                        <div class="sub-title">CPU</div>
                          <div>
                            <table>
                                <tr>
                                    <td>AC: </td>
                                    <td><input class="short-input" type="text" value="0" id="ac-box" /></td>
                                </tr>
                                <tr>
                                    <td>PC: </td>
                                    <td><input class="short-input" type="text" value="0" id="pc-box" /></td>
                                </tr>
                                <tr>
                                    <td>Z: </td>
                                    <td><input class="short-input" type="text" value="0" id="z-box" /></td>
                                </tr>
                                <tr>
                                    <td>N: </td>
                                    <td><input class="short-input" type="text" value="0" id="n-box" /></td>
                                </tr>
                                <tr>
                                    <td>Memory access: </td>
                                    <td>
                                        R: <span id="memory-read-access" />0</span>
                                        W: <span id="memory-write-access" />0</span>
                                    </td>
                                </tr>
                            </table>
                            <button id="clock-tick-button">Clock tick</button>
                            <button id="reset-button">Reset</button>
                            <button id="sleep-button">Sleep</button>
                        </div>
                        <div>
                            <button id="power-button">Power on</button>
                        </div>
                    </td>
                    <td valign="top">
                        <div>
                            <div class="sub-title">Stack</div>
                            <div id="stack-holder-holder"></div>
                            <button id="erase-stack-button">Erase stack</button>
                        </div>
                    </td>
                    <td valign="top">
                        <div class="sub-title">Memory</div>
                        <div id="memory-holder-holder"></div>
                        <button id="erase-memory-button">Erase memory</button>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<div id="memory-holder" class="draggable-item">
    <input type="text" id="memory-cell-edit-input" maxlength="8"/>
    <div id="memory-holder-tooltip">
        <table>
            <tr>
                <td>Mnemonic: </td>
                <td><span id="memory-holder-tooltip-mnemonic"></span></td>
            </tr>
            <tr>
                <td>Bin: </td>
                <td><span id="memory-holder-tooltip-bin"></span></td>
            </tr>
            <tr>
                <td>Hex: </td>
                <td><span id="memory-holder-tooltip-hex"></span></td>
            </tr>
            <tr>
                <td>Dec: </td>
                <td><span id="memory-holder-tooltip-dec"></span></td>
            </tr>
        </table>
    </div>
    <div id="memory-title" class="draggable-handler">
        <div class="icon-holder">
            <span class="ui-icon ui-icon-tag"></span>
        </div> 
        Main memory
    </div>
    <div id="memory-body"></div>
</div>
              
<div id="cpu-settings" class="draggable-item">
    <div id="cpu-settings-title" class="draggable-handler">
        <div class="icon-holder">
            <span class="ui-icon ui-icon-wrench"></span>
        </div> 
        Settings
    </div>
    <div id="cpu-settings-body">
        <div class="settings-sub-title">Base: </div>
        <div id="base-selector-radio">
            <input type="radio" id="radio-bin" name="radio" value="2" /><label for="radio-bin">Bin</label>
            <input type="radio" id="radio-oct" name="radio" value="8" /><label for="radio-oct">Oct</label>
            <input type="radio" id="radio-dec" name="radio" value="10" /><label for="radio-dec">Dec</label>
            <input type="radio" id="radio-hex" name="radio" value="16" checked="checked" /><label for="radio-hex">Hex</label>
        </div>
        <div class="settings-sub-title">Clock frequency  (1Hz~1kHz): </div>
        <input id="cpu-frequency-spinner" name="cpu-frequency" value="100" /> Hz
        <div id="cpu-frequency-slider"></div>
    </div>
</div>

<div id="ext-glcd" style="position: absolute; left: 920px; top: 45px;"></div>


<div id="views-container"></div>

<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="lib/jquery-ui/css/custom/jquery-ui-1.10.3.custom.css">
<script src="lib/jquery.js" type="text/javascript"></script>
<script src="lib/jquery-ui/js/jquery-ui-1.10.3.custom.js" type="text/javascript"></script>
<script src="converter.js" type="text/javascript"></script>
<script src="instructions.js" type="text/javascript"></script>
<script src="decoder.js" type="text/javascript"></script>
<script src="memory.js" type="text/javascript"></script>
<script src="stack.js" type="text/javascript"></script>
<script src="cpu.js" type="text/javascript"></script>
<script src="assembler.js" type="text/javascript"></script>
<script src="oscillator.js" type="text/javascript"></script>
<script src="message.js" type="text/javascript"></script>
<script src="launcher.js" type="text/javascript"></script>
<script src="UI.js" type="text/javascript"></script>

<script type="text/javascript">
    
    
    function loadView(view) {
        $("#views-container").append("<div></div>").load("view/" + view + "/" + view + ".html");
    }
    
    var availableViews = ["stack", "memory", "cpu"];
    
    UI.init(launcher);
    
    availableViews.map(function(view) {
        loadView(view);
    });
    
    
    /*
    
    
    
    var DEFAULT_BASE = 16;
    var assembler = new Assembler();
    Converter.setBase(DEFAULT_BASE);
    
    launcher = new Simulator();
    launcher.simulate("simulator.js");
    
    var prog = [0x02,0x37,0x0a,0x09,0x09,0x08,0x07,0x02,0xff,0x03,0x36,0x01,0x65,0x0b,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,-0x1,0x64];
    
    var mem = new ArrayBuffer(256);
    var memDv = new DataView(mem);
    for (var i = 0; i < prog.length; i++) {
        memDv.setInt8(i, prog[i]);
    }
    
    launcher.exchangeMessage(new Message(Message.TYPE.SET_MEMORY_BUFFER, mem), function(message) {
        console.log(message.getContent())
    });
    
    
    launcher.exchangeMessage(new Message(Message.TYPE.SET_CPU_POWER, false), function(message) {
        console.log(message.getContent());
    });
    launcher.exchangeMessage(new Message(Message.TYPE.SET_CPU_POWER, true), function(message) {
        console.log(message.getContent());
    });
    
    launcher.exchangeMessage(new Message(Message.TYPE.RESET_CPU, null), function(message) {
        console.log(message.getContent())
    });
    
    
    
    
    launcher.exchangeMessage(new Message(Message.TYPE.GET_STACK_BUFFER, "content"), function(message) {
        var dv = new DataView(message.getContent());
        dv.setInt8(0, 0x0a);
        console.log(dv.getInt8(0));
    });
    
    launcher.exchangeMessage(new Message(Message.TYPE.GET_SERIALIZED_CPU, "content"), function(message) {
        console.log(message.getContent());
    });
    
    launcher.exchangeMessage(new Message(Message.TYPE.SET_OSC_FREQUENCY, 10), function(message) {
        console.log(message.getContent());
    });
    
    launcher.exchangeMessage(new Message(Message.TYPE.SET_CPU_POWER, true), function(message) {
        console.log(message.getContent());
    });
    
    
    
    
    
    
    listener = new SimulatorEventListener(function(message) {
        if (message.getChannel() == 3) {
            console.log("dne:" + message.getContent());
        }
    });
    launcher3.addEventListener(Simulator.EVENT.ASYNC_MESSAGE_RECEIVED, listener);
    
    launcher2.exchangeMessage(new Message(Message.TYPE.ADD_MEMORY_EVENT_LISTENER, {"event": Memory.EVENT.AFTER_WRITE, "begin": 0, "end": 255}, 2), function(message) {
        console.log(message.getContent())
    });
    
    launcher.exchangeMessage(new Message(Message.TYPE.RESET_CPU, null), function(message) {
        console.log(message.getContent())
    });
    
    
    
    
    launcher.exchangeMessage(new Message(Message.TYPE.GET_MEMORY_BUFFER, null), function(message) {
        console.log("mem");
        var dv = new DataView(message.getContent());
        for (var i = 0; i < 255; i++) {
            console.log(dv.getInt8(i));
        }
    });
    
    var progSt = [0x02,0x37,0x0a,0x09,0x09,0x08,0x07,0x02,0xff,0x03,0x36,0x01,0x65,0x0b,0x00,0x00];
    
    var st = new ArrayBuffer(16);
    var stDv = new DataView(st);
    for (var i = 0; i < progSt.length; i++) {
        stDv.setInt8(i, progSt[i]);
    }
    launcher.exchangeMessage(new Message(Message.TYPE.SET_STACK_BUFFER, st), function(message) {
        console.log(message.getContent())
    });
    
    
    
    */
    //var ui = new UI(cpu);
    //ui.init();

//    $('#ext-glcd').load('ext/display/glcd/glcd.html');
    
</script>
<div class="footer">Written by Dalmir da Silva &lt;dalmirdasilva@gmail.com&gt;</div>
</body>
</html>
